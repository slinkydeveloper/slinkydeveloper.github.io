<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <link rel="manifest" href="/images/manifest.json">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script class="next-config" data-name="main" type="application/json">{"hostname":"slinkydeveloper.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.10.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

  <meta name="description" content="In this second chapter of Debts Manager Tutorial I would like to show you how I have designed the REST API of Debts Manager. I&#39;m going to follow the API First approach, documenting all aspects of the">
<meta property="og:type" content="article">
<meta property="og:title" content="Debts Manager Tutorial Part 2: Contract Design">
<meta property="og:url" content="https://slinkydeveloper.com/Debts-Manager-Tutorial-Contract-Design/index.html">
<meta property="og:site_name" content="Slinky&#39;s corner">
<meta property="og:description" content="In this second chapter of Debts Manager Tutorial I would like to show you how I have designed the REST API of Debts Manager. I&#39;m going to follow the API First approach, documenting all aspects of the">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2019-01-20T08:10:00.000Z">
<meta property="article:modified_time" content="2023-08-28T15:56:42.185Z">
<meta property="article:author" content="Software Engineer">
<meta property="article:tag" content="openapi">
<meta property="article:tag" content="vertx">
<meta property="article:tag" content="development">
<meta property="article:tag" content="web">
<meta property="article:tag" content="web api contract">
<meta property="article:tag" content="openapi 3">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://slinkydeveloper.com/Debts-Manager-Tutorial-Contract-Design/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://slinkydeveloper.com/Debts-Manager-Tutorial-Contract-Design/","path":"Debts-Manager-Tutorial-Contract-Design/","title":"Debts Manager Tutorial Part 2: Contract Design"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Debts Manager Tutorial Part 2: Contract Design | Slinky's corner</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-39408029-2"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-39408029-2","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>




<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#252e39"
    },
    "button": {
      "background": "#14a7d0"
    }
  }
})});
</script>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Slinky's corner" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Slinky's corner</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Personal blog of Francesco Guardiani, Software Engineer</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Analysis"><span class="nav-number">1.</span> <span class="nav-text">Analysis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Models"><span class="nav-number">2.</span> <span class="nav-text">Models</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Endpoints"><span class="nav-number">3.</span> <span class="nav-text">Endpoints</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Transactions-and-Status"><span class="nav-number">3.1.</span> <span class="nav-text">Transactions and Status</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#User-and-User-relationships"><span class="nav-number">3.2.</span> <span class="nav-text">User and User relationships</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Login-registration-and-JWT"><span class="nav-number">3.3.</span> <span class="nav-text">Login, registration and JWT</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Some-resources-to-learn-Web-API-Design-and-OpenAPI"><span class="nav-number">4.</span> <span class="nav-text">Some resources to learn Web API Design and OpenAPI</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conclusion"><span class="nav-number">5.</span> <span class="nav-text">Conclusion</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Software Engineer</p>
  <div class="site-description" itemprop="description">Personal blog of Francesco Guardiani, Software Engineer</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">41</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/slinkydeveloper" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;slinkydeveloper" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:francescoguard@gmail.com" title="E-Mail → mailto:francescoguard@gmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/SlinkyGuardiani" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;SlinkyGuardiani" rel="noopener" target="_blank"><i class="twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://stackoverflow.com/users/2399055/francesco-guardiani" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;2399055&#x2F;francesco-guardiani" rel="noopener" target="_blank"><i class="stack-overflow fa-fw"></i>StackOverflow</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://slinkydeveloper.com/Debts-Manager-Tutorial-Contract-Design/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Software Engineer">
      <meta itemprop="description" content="Personal blog of Francesco Guardiani, Software Engineer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Slinky's corner">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Debts Manager Tutorial Part 2: Contract Design
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 20-01-2019 09:10:00" itemprop="dateCreated datePublished" datetime="2019-01-20T09:10:00+01:00">20-01-2019</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 28-08-2023 17:56:42" itemprop="dateModified" datetime="2023-08-28T17:56:42+02:00">28-08-2023</time>
    </span>

  
</div>

            <div class="post-description">In this second chapter of Debts Manager Tutorial I would like to show you how I have designed the REST API of Debts Manager. I'm going to follow the API First approach, documenting all aspects of the API Design with OpenAPI 3.</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Hi guys! Welcome back to this tutorial!</p>
<p>In this second chapter of Debts Manager Tutorial I would like to show you how I have designed the REST API of Debts Manager. I’m going to follow the <em>API First</em> approach, documenting all aspects of the API Design with OpenAPI 3.</p>
<p>This post doesn’t aim to provide you a full guide of how to design REST APIs: if you want more resources to learn it, <a href="#Some-resources-to-learn-Web-API-Design-and-OpenAPI">look at the end of this post</a></p>
<h2 id="Analysis">Analysis</h2>
<p>The REST APIs, in contrast with RPC, are driven by the data the services wants to expose. In the previous chapter I gave you an idea of the entities we must expose. Now I tabulate these and the relative operations on it.</p>
<table>
<thead>
<tr>
<th>Entity</th>
<th>Create</th>
<th>Retrieve</th>
<th>Update</th>
<th>Delete</th>
</tr>
</thead>
<tbody>
<tr>
<td>User</td>
<td><span class="emoji" alias="heavy_check_mark" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png?v8">✔</span></td>
<td><span class="emoji" alias="heavy_check_mark" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png?v8">✔</span></td>
<td><span class="emoji" alias="x" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8">❌</span></td>
<td><span class="emoji" alias="x" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8">❌</span></td>
</tr>
<tr>
<td>User relationship</td>
<td><span class="emoji" alias="heavy_check_mark" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png?v8">✔</span></td>
<td><span class="emoji" alias="heavy_check_mark" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png?v8">✔</span></td>
<td><span class="emoji" alias="x" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8">❌</span></td>
<td><span class="emoji" alias="x" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8">❌</span></td>
</tr>
<tr>
<td>Transaction</td>
<td><span class="emoji" alias="heavy_check_mark" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png?v8">✔</span></td>
<td><span class="emoji" alias="heavy_check_mark" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png?v8">✔</span></td>
<td><span class="emoji" alias="heavy_check_mark" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png?v8">✔</span></td>
<td><span class="emoji" alias="heavy_check_mark" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png?v8">✔</span></td>
</tr>
<tr>
<td>Status</td>
<td><span class="emoji" alias="x" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8">❌</span></td>
<td><span class="emoji" alias="heavy_check_mark" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png?v8">✔</span></td>
<td><span class="emoji" alias="x" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8">❌</span></td>
<td><span class="emoji" alias="x" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8">❌</span></td>
</tr>
</tbody>
</table>
<p>This table is a pretty good starting point, but I must refine the analysis enforcing our methods with policies and logics.</p>
<p>These policies are primarly based on <em>who is making the request</em>. I’m going to define a login phase together with JWT to provide authorization and authentication. Each endpoint, except <code>login</code> and <code>register</code>, is secured with a JWT auth. My objective is expose, for each user, only a subset of data relative to the user itself.</p>
<h2 id="Models">Models</h2>
<p>Before defining the endpoints I must formally describe the data models representing the service entities. OpenAPI has its own Json Schema dialect to define models: <a target="_blank" rel="noopener" href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.2.md#schemaObject">OpenAPI Schema</a>. This is an extended subset of <a target="_blank" rel="noopener" href="http://json-schema.org/specification-links.html#draft-5">Json Schema Draft 5</a>. Meanwhile I’m writing, there is a proposal to allow usage of every version of Json Schema, including the newer versions, with an extension <a target="_blank" rel="noopener" href="https://github.com/OAI/OpenAPI-Specification/issues/1532">https://github.com/OAI/OpenAPI-Specification/issues/1532</a>.</p>
<p>I place these schemas in main OpenAPI file under <code>components</code> and <code>schemas</code> keywords. I can refeer to it using Json schema references (<code>$ref</code> keyword).</p>
<p>The simplest model here is the user. I want to expose only the username, so I represent it with a simple <code>string</code>. This is the definition using OpenAPI Schema:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Username:</span></span><br><span class="line">  <span class="attr">minLength:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>
<p>The status is represented by a map with users as keys and total debts\credits as values. In OpenAPI Schema:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Status:</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">&#x27;Map with username as keys and debt as value&#x27;</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">  <span class="attr">additionalProperties:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">number</span></span><br></pre></td></tr></table></figure>
<p>In JSON maps are usually represented or as json array of tuples key-value or as a json object. The json object is the natural way to represent it, but it has an important restriction: keys are strings. In my case I need to represent a map string → number, so json object representation fits good. The map values schema are defined using <code>additionalProperties</code> and, only with Json Schema Draft 7 or newer, keys schema are defined using <code>propertyNames</code>.</p>
<p>The main transaction model is described below:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Transaction:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">  <span class="attr">properties:</span></span><br><span class="line">    <span class="attr">id:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">    <span class="attr">from:</span></span><br><span class="line">      <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Username&#x27;</span></span><br><span class="line">    <span class="attr">to:</span></span><br><span class="line">      <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Username&#x27;</span></span><br><span class="line">    <span class="attr">at:</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">&quot;Insertion datetime&quot;</span></span><br><span class="line">      <span class="attr">format:</span> <span class="string">date-time</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">    <span class="attr">value:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">number</span></span><br><span class="line">    <span class="attr">description:</span></span><br><span class="line">      <span class="attr">minLength:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">required:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">from</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">to</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">id</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">description</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">value</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">at</span></span><br></pre></td></tr></table></figure>
<p><code>$ref</code> keyword points to the <code>Username</code> schema I defined before.</p>
<p>This model doesn’t fit good for my usage, because for each <code>Transaction</code> endpoint I want to apply some policies. A very common example is the <code>id</code> field: when user inserts a new transaction I want to designate the database to fill the <code>id</code> value. When the user creates a new transaction it shouldn’t add the <code>id</code> field: that means that I can’t use the <code>Transaction</code> model to describe the “create transaction” request body. Let’s look at all restrictions I want to apply on various transaction endpoints:</p>
<ul>
<li><code>id</code> and <code>at</code> are filled by the backend when user adds a new transaction and they are immutable from the API perspective</li>
<li>When user updates a transaction he can’t update the <code>from</code> (sender) and <code>to</code> (receiver) fields</li>
<li>When user adds a new transaction he doesn’t need to fill the <code>from</code> field because the backend fills it with the logged user</li>
</ul>
<p>To apply these restrictions I create a new model for each endpoint. I’m going to refactor <code>Transaction</code> into 3 different models: <code>UpdateTransaction</code>, <code>NewTransaction</code> and <code>Transaction</code>.</p>
<p>These new models lead to a new problem: duplication of model fields definitions. Json schema solves the duplication with schema composition keywords: <code>allOf</code>, <code>anyOf</code> and <code>oneOf</code>. In particular I will use <code>allOf</code> to achieve inheritance of schemas.</p>
<p>This is the final result:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">UpdateTransaction:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">  <span class="attr">properties:</span></span><br><span class="line">    <span class="attr">value:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">number</span></span><br><span class="line">    <span class="attr">description:</span></span><br><span class="line">      <span class="attr">minLength:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="attr">NewTransaction:</span></span><br><span class="line">  <span class="attr">allOf:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/UpdateTransaction&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">to:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Username&#x27;</span></span><br><span class="line">      <span class="attr">required:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">to</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">description</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">value</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line"><span class="attr">Transaction:</span></span><br><span class="line">  <span class="attr">allOf:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/NewTransaction&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">required:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">from</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">to</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">id</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">description</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">value</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">at</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">from:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Username&#x27;</span></span><br><span class="line">        <span class="attr">id:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">at:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">&quot;Insertion datetime&quot;</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">date-time</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>
<p>The schemas inheritance tree is <code>UpdateTransaction</code>←<code>NewTransaction</code>←<code>Transaction</code></p>
<h2 id="Endpoints">Endpoints</h2>
<p>OpenAPI document structures the endpoint definitions as follow:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/pathA:</span> &#123;&#125;</span><br><span class="line">  <span class="string">/pathB:</span></span><br><span class="line">    <span class="attr">get:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">post:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">put:</span> &#123;&#125;</span><br><span class="line">  <span class="string">/pathC/&#123;paramA&#125;:</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>OpenAPI path strings allow path parameters using <code>&#123;paramName&#125;</code> and doesn’t require an explicit definition of query parameters.</p>
<p>In OpenAPI terminology an <strong>operation</strong> is an API endpoint identified by a path and an HTTP method. Every operation could be uniquely identified with an <code>operationId</code>. The OpenAPI Specification (OAS) documents this field as optional, but I strongly suggest to specify it if you don’t want to see your tooling explode. Most code generation tooling asserts that <code>operationId</code> is present. If it’s not present they try to infeer it from path and http method producing unexpected results.</p>
<p>For each operation we are going to define:</p>
<ul>
<li><code>operationId</code></li>
<li><code>parameters</code> (if any): List of <code>header</code>, <code>path</code>, <code>query</code> and <code>cookie</code> parameters</li>
<li><code>requestBody</code> (if any): Content type and content schema of request bodies</li>
<li><code>responses</code>: Status code with response content type and schemas</li>
</ul>
<p>I also fill the <code>security</code> field for each operation to require a JWT token to execute it.</p>
<h3 id="Transactions-and-Status">Transactions and Status</h3>
<p>Let’s start with transaction CRUDs:</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th><code>operationId</code></th>
<th>CRUD</th>
<th>Path</th>
<th>HTTP Method</th>
</tr>
</thead>
<tbody>
<tr>
<td>Create a new transaction</td>
<td><code>createTransaction</code></td>
<td><strong>C</strong>reate</td>
<td><code>/transactions</code></td>
<td>POST</td>
</tr>
<tr>
<td>Get a single transaction</td>
<td><code>getTransaction</code></td>
<td><strong>R</strong>etrieve</td>
<td><code>/transactions/&#123;transactionId&#125;</code></td>
<td>GET</td>
</tr>
<tr>
<td>Get user related transactions</td>
<td><code>getTransactions</code></td>
<td><strong>R</strong>etrieve multiple</td>
<td><code>/transactions</code></td>
<td>GET</td>
</tr>
<tr>
<td>Update a transaction</td>
<td><code>updateTransaction</code></td>
<td><strong>U</strong>pdate</td>
<td><code>/transactions/&#123;transactionId&#125;</code></td>
<td>PUT</td>
</tr>
<tr>
<td>Delete a transaction</td>
<td><code>deleteTransaction</code></td>
<td><strong>D</strong>elete</td>
<td><code>/transactions/&#123;transactionId&#125;</code></td>
<td>DELETE</td>
</tr>
</tbody>
</table>
<p>In OpenAPI:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">/transactions:</span></span><br><span class="line">  <span class="attr">get:</span></span><br><span class="line">    <span class="attr">operationId:</span> <span class="string">getTransactions</span></span><br><span class="line">    <span class="attr">responses:</span></span><br><span class="line">      <span class="attr">&#x27;200&#x27;:</span></span><br><span class="line">        <span class="attr">content:</span></span><br><span class="line">          <span class="attr">application/json:</span></span><br><span class="line">            <span class="attr">schema:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">items:</span></span><br><span class="line">                <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Transaction&#x27;</span></span><br><span class="line">      <span class="attr">&#x27;401&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Expired token&#x27;</span></span><br><span class="line">    <span class="attr">security:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">loggedUserToken:</span> []</span><br><span class="line">  <span class="attr">post:</span></span><br><span class="line">    <span class="attr">operationId:</span> <span class="string">createTransaction</span></span><br><span class="line">    <span class="attr">requestBody:</span></span><br><span class="line">      <span class="attr">content:</span></span><br><span class="line">        <span class="attr">application/json:</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/NewTransaction&#x27;</span></span><br><span class="line">      <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">responses:</span></span><br><span class="line">      <span class="attr">&#x27;201&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Successful response.&#x27;</span></span><br><span class="line">      <span class="attr">&#x27;401&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Expired Token&#x27;</span></span><br><span class="line">      <span class="attr">&#x27;403&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&quot;Trying to create a transaction with receiver not connected to logged user&quot;</span></span><br><span class="line">    <span class="attr">security:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">loggedUserToken:</span> []</span><br><span class="line"><span class="string">&#x27;/transactions/&#123;transactionId&#125;&#x27;</span><span class="string">:</span></span><br><span class="line">  <span class="attr">get:</span></span><br><span class="line">    <span class="attr">operationId:</span> <span class="string">getTransaction</span></span><br><span class="line">    <span class="attr">responses:</span></span><br><span class="line">      <span class="attr">&#x27;200&#x27;:</span></span><br><span class="line">        <span class="attr">content:</span></span><br><span class="line">          <span class="attr">application/json:</span></span><br><span class="line">            <span class="attr">schema:</span></span><br><span class="line">              <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Transaction&#x27;</span></span><br><span class="line">      <span class="attr">&#x27;401&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Expired Token&#x27;</span></span><br><span class="line">      <span class="attr">&#x27;403&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&quot;Trying to get a transaction where `from` or `to` is not the logged user&quot;</span></span><br><span class="line">    <span class="attr">security:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">loggedUserToken:</span> []</span><br><span class="line">  <span class="attr">put:</span></span><br><span class="line">    <span class="attr">operationId:</span> <span class="string">updateTransaction</span></span><br><span class="line">    <span class="attr">requestBody:</span></span><br><span class="line">      <span class="attr">content:</span></span><br><span class="line">        <span class="attr">application/json:</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/UpdateTransaction&#x27;</span></span><br><span class="line">      <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">responses:</span></span><br><span class="line">      <span class="attr">&#x27;202&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Successful response.&#x27;</span></span><br><span class="line">      <span class="attr">&#x27;401&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Expired Token&#x27;</span></span><br><span class="line">      <span class="attr">&#x27;403&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Trying to update a transaction where `from` is not the logged user&#x27;</span></span><br><span class="line">    <span class="attr">security:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">loggedUserToken:</span> []</span><br><span class="line">  <span class="attr">delete:</span></span><br><span class="line">    <span class="attr">operationId:</span> <span class="string">deleteTransaction</span></span><br><span class="line">    <span class="attr">responses:</span></span><br><span class="line">      <span class="attr">&#x27;204&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Successful response.&#x27;</span></span><br><span class="line">      <span class="attr">&#x27;401&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Expired Token &#x27;</span></span><br><span class="line">      <span class="attr">&#x27;403&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Trying to remove a transaction where `from` is not the logged user&#x27;</span></span><br><span class="line">    <span class="attr">security:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">loggedUserToken:</span> []</span><br><span class="line">  <span class="attr">parameters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">transactionId</span></span><br><span class="line">      <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">      <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">schema:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>
<p>Note that for all operations under <code>/transactions/&#123;transactionId&#125;</code> path I haven’t redefined every time the parameter <code>transactionId</code>: I have defined once at path level.</p>
<p>Status has only the <em>retrieve</em> operation, but I want to let user customize the output based on transactions insertion datetime: clients can use query parameter <code>till</code> to ask the status till the date time provided, excluding newer transactions. You can use it to throw back in your house mate face that he didn’t pay the bills for a quite long time.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">/status:</span></span><br><span class="line">  <span class="attr">get:</span></span><br><span class="line">    <span class="attr">operationId:</span> <span class="string">getUserStatus</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">till</span></span><br><span class="line">        <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">        <span class="attr">required:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">schema:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">&#x27;date-time&#x27;</span></span><br><span class="line">    <span class="attr">responses:</span></span><br><span class="line">      <span class="attr">&#x27;200&#x27;:</span></span><br><span class="line">        <span class="attr">content:</span></span><br><span class="line">          <span class="attr">application/json:</span></span><br><span class="line">            <span class="attr">schema:</span></span><br><span class="line">              <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Status&#x27;</span></span><br><span class="line">      <span class="attr">&#x27;401&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Expired token&#x27;</span></span><br><span class="line">    <span class="attr">security:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">loggedUserToken:</span> []</span><br></pre></td></tr></table></figure>
<h3 id="User-and-User-relationships">User and User relationships</h3>
<p>The service supports creation and retrieval of users and user relationships. For simplicity I avoided to include <strong>U</strong> and <strong>D</strong> operations for user and user relationships.</p>
<p>I want to expose an endpoint to retrieve all registered users and an endpoint to retrieve only users that have a relationship with logged user:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">/users:</span></span><br><span class="line">  <span class="attr">get:</span></span><br><span class="line">    <span class="attr">operationId:</span> <span class="string">getUsers</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">filter</span></span><br><span class="line">        <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">        <span class="attr">schema:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">    <span class="attr">responses:</span></span><br><span class="line">      <span class="attr">&#x27;200&#x27;:</span></span><br><span class="line">        <span class="attr">content:</span></span><br><span class="line">          <span class="attr">application/json:</span></span><br><span class="line">            <span class="attr">schema:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">items:</span></span><br><span class="line">                <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Username&#x27;</span></span><br><span class="line">      <span class="attr">&#x27;401&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Expired token&#x27;</span></span><br><span class="line">    <span class="attr">security:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">loggedUserToken:</span> []</span><br><span class="line"><span class="string">/users/connected:</span></span><br><span class="line">  <span class="attr">get:</span></span><br><span class="line">    <span class="attr">operationId:</span> <span class="string">getConnectedUsers</span></span><br><span class="line">    <span class="attr">responses:</span></span><br><span class="line">      <span class="attr">&#x27;200&#x27;:</span></span><br><span class="line">        <span class="attr">content:</span></span><br><span class="line">          <span class="attr">application/json:</span></span><br><span class="line">            <span class="attr">schema:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">              <span class="attr">properties:</span></span><br><span class="line">                <span class="attr">allowedTo:</span></span><br><span class="line">                  <span class="attr">description:</span> <span class="string">&quot;Users that logged user can bill&quot;</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                  <span class="attr">items:</span></span><br><span class="line">                    <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Username&#x27;</span></span><br><span class="line">                <span class="attr">allowedFrom:</span></span><br><span class="line">                  <span class="attr">description:</span> <span class="string">&quot;Users that can bill the logged user&quot;</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                  <span class="attr">items:</span></span><br><span class="line">                    <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Username&#x27;</span></span><br><span class="line">      <span class="attr">&#x27;401&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Expired token&#x27;</span></span><br><span class="line">    <span class="attr">security:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">loggedUserToken:</span> []</span><br></pre></td></tr></table></figure>
<p>In <code>getUsers</code> we defined a very basic search functionality with the optional query parameter <code>filter</code></p>
<p>In <code>getConnectedUser</code> I prefeered to define the request schema directly inside the request body definition because It’s a schema strictly related to this operation and It isn’t parent of any other schema.</p>
<p>This is the endpoint to create a user connection (user relationship):</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">/users/connected/&#123;userToConnect&#125;:</span></span><br><span class="line">  <span class="attr">post:</span></span><br><span class="line">    <span class="attr">operationId:</span> <span class="string">connectUser</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">userToConnect</span></span><br><span class="line">        <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">        <span class="attr">schema:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Username&#x27;</span></span><br><span class="line">    <span class="attr">responses:</span></span><br><span class="line">      <span class="attr">&#x27;201&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;User connected&#x27;</span></span><br><span class="line">      <span class="attr">&#x27;401&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Expired token&#x27;</span></span><br><span class="line">    <span class="attr">security:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">loggedUserToken:</span> []</span><br></pre></td></tr></table></figure>
<h3 id="Login-registration-and-JWT">Login, registration and JWT</h3>
<p>When an user wants to start using this API he must <strong>authenticate</strong> with his credentials following this process:</p>
<ol>
<li>User calls the <code>/login</code> endpoint passing his credentials in the request body</li>
<li>The backend checks if credentials are correct</li>
<li>The backend writes the response with a JWT token containing the username inside the payload</li>
<li>User stores the received JWT token</li>
</ol>
<p>For each request the server must <strong>authorize</strong> the user. The user must include inside each request the header <code>Authorization: Bearer &lt;jwt token&gt;</code>. When the backend receives the request it checks the signature validity and the token expiration time. If the token is valid It parses the payload, where It can read the username of the logged user.</p>
<p>This is the <code>login</code> operation definition:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">/login:</span></span><br><span class="line">  <span class="attr">post:</span></span><br><span class="line">    <span class="attr">operationId:</span> <span class="string">login</span></span><br><span class="line">    <span class="attr">requestBody:</span></span><br><span class="line">      <span class="attr">content:</span></span><br><span class="line">        <span class="attr">application/json:</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">required:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">password</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">username:</span></span><br><span class="line">                <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Username&#x27;</span></span><br><span class="line">              <span class="attr">password:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">responses:</span></span><br><span class="line">      <span class="attr">&#x27;200&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Returns the JWT token&#x27;</span></span><br><span class="line">        <span class="attr">content:</span></span><br><span class="line">          <span class="attr">text/plain:</span> &#123;&#125;</span><br><span class="line">      <span class="attr">&#x27;400&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Wrong username or password&#x27;</span></span><br></pre></td></tr></table></figure>
<p>The <code>register</code> operation creates a new user and logins it:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">/register:</span></span><br><span class="line">  <span class="attr">post:</span></span><br><span class="line">    <span class="attr">operationId:</span> <span class="string">register</span></span><br><span class="line">    <span class="attr">requestBody:</span></span><br><span class="line">      <span class="attr">content:</span></span><br><span class="line">        <span class="attr">application/json:</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">required:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">password</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">username:</span></span><br><span class="line">                <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Username&#x27;</span></span><br><span class="line">              <span class="attr">password:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">responses:</span></span><br><span class="line">      <span class="attr">&#x27;200&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Returns the JWT Token&#x27;</span></span><br><span class="line">        <span class="attr">content:</span></span><br><span class="line">          <span class="attr">text/plain:</span> &#123;&#125;</span><br><span class="line">      <span class="attr">&#x27;400&#x27;:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">&#x27;Username already exists&#x27;</span></span><br></pre></td></tr></table></figure>
<p>I don’t cover in this tutorial the logout process, but I want to give you a tip: create a whitelist or blacklist of tokens.</p>
<p>As you already saw, each secured operation has the <code>security</code> field:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">security:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">loggedUserToken:</span> []</span><br></pre></td></tr></table></figure>
<p>The <code>security</code> field is called <strong>security requirement</strong> and it tells the user that he needs <code>loggedUserToken</code> <strong>security schema</strong> to access to this endpoint. Security schemas must be defined under <code>#/components/securitySchemes</code>:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">securitySchemes:</span></span><br><span class="line">  <span class="attr">loggedUserToken:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">scheme:</span> <span class="string">bearer</span></span><br></pre></td></tr></table></figure>
<h2 id="Some-resources-to-learn-Web-API-Design-and-OpenAPI">Some resources to learn Web API Design and OpenAPI</h2>
<p>I give you a couple of useful links:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.restapitutorial.com/">Rest API Tutorial</a>: Very simple and coincise tutorial for newbies of REST APIs world</li>
<li><a target="_blank" rel="noopener" href="http://apistylebook.com/">API Stylebook</a>: Collection of API styleguides from different IT companies</li>
<li><a target="_blank" rel="noopener" href="https://github.com/OAI/OpenAPI-Specification/">OpenAPI Specification repository</a>: Contains the spec and examples</li>
<li><a target="_blank" rel="noopener" href="https://apis.guru/browse-apis/">OpenAPI Directory</a>: Collection of OpenAPIs of different public APIs</li>
</ul>
<h2 id="Conclusion">Conclusion</h2>
<p>You can find the complete OpenAPI definition here: <a target="_blank" rel="noopener" href="https://github.com/slinkydeveloper/debts-manager/blob/master/src/main/resources/debts_manager_api.yaml">/src/main/resources/debts_manager_api.yaml</a></p>
<p>After you learnt how to design a REST API, approacching to OpenAPI is very simple. The operation definition is very intuitive because of 1:1 mapping with HTTP (methods, parameters, status codes, content types and so on). The tricky and magic part, for me, is definining and organizing the JSON Schemas. When you define simple models, you tend to put everything inside the same file. But when you raise the complexity using composed schemas, you get flooded by smaller and unclear schemas. My suggestion for you is to document the schemas with <code>title</code> and <code>description</code> keywords and organize these in multiple files.</p>
<p>In next chapter I’m going to bootstrap the project and start writing first Vert.x code, stay tuned!</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/openapi/" rel="tag"># openapi</a>
              <a href="/tags/vertx/" rel="tag"># vertx</a>
              <a href="/tags/development/" rel="tag"># development</a>
              <a href="/tags/web/" rel="tag"># web</a>
              <a href="/tags/web-api-contract/" rel="tag"># web api contract</a>
              <a href="/tags/openapi-3/" rel="tag"># openapi 3</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/Debts-Manager-Tutorial-Introduction/" rel="prev" title="Debts Manager Tutorial Part 1: Introduction">
                  <i class="fa fa-chevron-left"></i> Debts Manager Tutorial Part 1: Introduction
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/Debts-Manager-Tutorial-Vert-x-Web-API-Contract-Service/" rel="next" title="Debts Manager Tutorial Part 3: Vert.x Web API Contract & Service">
                  Debts Manager Tutorial Part 3: Vert.x Web API Contract & Service <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Software Engineer</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.13.10/dist/mermaid.min.js","integrity":"sha256-CmZCFVnvol9YL23PfjDflGY5nJwE+Mf/JN+8v+tD/34="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>

  <script src="/js/third-party/fancybox.js"></script>


  





</body>
</html>
